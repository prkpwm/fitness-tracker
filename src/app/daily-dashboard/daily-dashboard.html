<div class="daily-dashboard">
  <header class="header">
    <h1><i class="icon">üí™</i> FITNESS TRACKER</h1>
    <div class="date">{{today | date:'fullDate'}}</div>
  </header>

  <div class="date-selector-header">
    <div class="date-selector">
      <button class="date-nav" (click)="changeDate(-1)">‚óÄ</button>
      <input type="date" [(ngModel)]="selectedDateString" (change)="onDateChange()" class="date-input">
      <button class="date-nav" (click)="changeDate(1)">‚ñ∂</button>
    </div>
    <div class="dashboard-date text-center">{{selectedDate | date:'EEEE, MMMM d, y'}}</div>
  </div>

  @if (loading) {
  <div class="loading">
    <div class="loading-spinner"></div>
    <p>Loading...</p>
  </div>
  } @else if (currentData) {
  <div class="dashboard">
    <div class="dashboard-section">
      <div class="dashboard-header">
        <h2 class="section-title">üìä Today's Dashboard</h2>
      </div>
      
      <div class="primary-stats">
        <div class="primary-card calories-card">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">üî•</span>
              <span class="stat-title">Calories</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.total_intake_calories | number:'1.0-0'}}</span>
              <span class="stat-unit">/ {{currentData.user_profile.goal_calories | number:'1.0-0'}}</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress calories-progress" [style.width.%]="getCalorieProgress()"></div>
              </div>
              <span class="progress-text">{{getCalorieProgress() | number:'1.0-0'}}% of goal</span>
            </div>
          </div>
        </div>
        
        <div class="primary-card protein-card">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">ü•õ</span>
              <span class="stat-title">Protein</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.total_protein_g | number:'1.0-0'}}</span>
              <span class="stat-unit">g / {{currentData.user_profile.maintenance_protein_target_g | number:'1.0-0'}}g</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress protein-progress" [style.width.%]="getProteinProgress()"></div>
              </div>
              <span class="progress-text">{{getProteinProgress() | number:'1.0-0'}}% of target</span>
            </div>
          </div>
        </div>
        
        <div class="primary-card status-card" [class]="'status-' + getStatusClass()">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">{{getStatusEmoji()}}</span>
              <span class="stat-title">Status</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.net_calories | number:'1.0-0'}}</span>
              <span class="stat-unit">net cal</span>
            </div>
            <div class="status-label">{{getStatusText()}}</div>
          </div>
        </div>
      </div>
      
      <div class="secondary-stats">
        <div class="stat-tile">
          <div class="tile-icon">‚ö°</div>
          <div class="tile-value">{{currentData.exercise_summary.total_burned_calories | number:'1.0-0'}}</div>
          <div class="tile-label">Burned</div>
        </div>
        
        <div class="stat-tile weight-tile">
          <div class="tile-icon">‚öñÔ∏è</div>
          @if (!editingWeight) {
          <div class="tile-value" (click)="startEditWeight()">{{currentData.user_profile.weight_kg | number:'1.1-1'}}kg</div>
          <div class="tile-label">Weight (click to edit)</div>
          <div class="tile-sublabel">BMI: {{getBMI() | number:'1.1-1'}} ({{getBMICategory()}})</div>
          } @else {
          <div class="weight-edit">
            <input [(ngModel)]="tempWeight" type="number" class="weight-input" placeholder="Weight">
            <div class="weight-actions">
              <button class="save-btn" (click)="saveWeight()">‚úì</button>
              <button class="cancel-btn" (click)="cancelEditWeight()">√ó</button>
            </div>
          </div>
          }
        </div>
        
        <div class="stat-tile" [class]="getCarbsStatus()">
          <div class="tile-icon">üçû</div>
          <div class="tile-value">{{currentData.daily_total_stats.total_carbs_g | number:'1.0-0'}}g</div>
          <div class="tile-label">Carbs {{getCarbsPercentage()}} (45-65%)</div>
          <div class="tile-sublabel">{{getCarbsDescription()}}</div>
        </div>
        
        <div class="stat-tile" [class]="getFatStatus()">
          <div class="tile-icon">ü•ë</div>
          <div class="tile-value">{{currentData.daily_total_stats.total_fat_g | number:'1.0-0'}}g</div>
          <div class="tile-label">Fat {{getFatPercentage()}} (20-35%)</div>
          <div class="tile-sublabel">{{getFatDescription()}}</div>
        </div>
      </div>
    </div>

    <div class="overview-section">
      <div class="overview-grid">
        <div class="overview-card goals">
          <h3>üéØ Daily Goals</h3>
          <div class="goal-progress">
            <div class="goal-item">
              <span>Calories: {{currentData.daily_total_stats.total_intake_calories | number:'1.0-0'}}/{{currentData.user_profile.goal_calories | number:'1.0-0'}}</span>
              <div class="mini-progress">
                <div class="mini-bar" [style.width.%]="getCalorieProgress()"></div>
              </div>
            </div>
            <div class="goal-item">
              <span>Protein: {{currentData.daily_total_stats.total_protein_g | number:'1.0-0'}}/{{currentData.user_profile.maintenance_protein_target_g | number:'1.0-0'}}g</span>
              <div class="mini-progress">
                <div class="mini-bar" [style.width.%]="getProteinProgress()"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="overview-card summary">
          <h3>üìà Today's Summary</h3>
          <div class="summary-stats">
            <div class="summary-item">
              <span class="summary-label">Total Intake:</span>
              <span class="summary-value">{{currentData.daily_total_stats.total_intake_calories | number:'1.0-0'}} cal</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Exercise Burned:</span>
              <span class="summary-value">{{currentData.exercise_summary.total_burned_calories | number:'1.0-0'}} cal</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Net Balance:</span>
              <span class="summary-value" [class]="getStatusClass()">{{currentData.daily_total_stats.net_calories | number:'1.0-0'}} cal</span>
            </div>
          </div>
        </div>
        
        <div class="overview-card ai-evaluation">
          <h3>ü§ñ AI Evaluation</h3>
          <div class="ai-stats">
            <div class="ai-item">
              <span class="ai-label">Muscle Maintenance:</span>
              <span class="ai-value">{{currentData.ai_evaluation.muscle_maintenance}}</span>
            </div>
            <div class="ai-item">
              <span class="ai-label">Weight Loss Status:</span>
              <span class="ai-value">{{currentData.ai_evaluation.weight_loss_status}}</span>
            </div>
            <div class="ai-recommendation">
              <span class="ai-label">Recommendation:</span>
              <p class="ai-text">{{currentData.ai_evaluation.recommendation}}</p>
            </div>
          </div>
        </div>
        
        <div class="overview-card net-cal-recommendation">
          <h3>üí° Net Calorie Analysis</h3>
          <div class="recommendation-content">
            <div class="net-cal-status" [class]="getStatusClass()">
              <span class="status-icon">{{getStatusEmoji()}}</span>
              <span class="status-text">{{getNetCalorieRecommendation()}}</span>
            </div>
            <div class="calorie-comparison">
              <div class="comparison-item">
                <span class="comparison-label">Recommended:</span>
                <span class="comparison-value">{{getRecommendedCalories() | number:'1.0-0'}} cal</span>
              </div>
              <div class="comparison-item">
                <span class="comparison-label">Net Calories:</span>
                <span class="comparison-value" [class]="getStatusClass()">{{currentData.daily_total_stats.net_calories | number:'1.0-0'}} cal</span>
              </div>
              <div class="comparison-item difference">
                <span class="comparison-label">Difference:</span>
                <span class="comparison-value" [class]="getDifferenceClass()">{{getCalorieDifference() | number:'1.0-0'}} cal</span>
              </div>
            </div>
            <div class="recommendation-details">
              <p>{{getNetCalorieAdvice()}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="details-section">
      <div class="content-grid">
        <div class="card food-card">
          <div class="card-header">
            <h3><i class="icon">üçΩÔ∏è</i> Food Diary</h3>
            <button class="add-btn" (click)="showAddFood = !showAddFood">{{showAddFood ? '‚àí' : '+'}}</button>
          </div>
          
          @if (showAddFood) {
          <div class="add-form">
            <div class="form-field">
              <label>Food:</label>
              <input [(ngModel)]="newFood.item" placeholder="e.g. Chicken Breast, Apple" class="input">
            </div>
            <div class="form-field">
              <label>Calories:</label>
              <input [(ngModel)]="newFood.calories" type="number" placeholder="e.g. 250" class="input">
            </div>
            <div class="form-field">
              <label>Protein:</label>
              <input [(ngModel)]="newFood.protein_g" type="number" placeholder="grams (e.g. 25)" class="input">
            </div>
            <div class="form-field">
              <label>Carbs:</label>
              <input [(ngModel)]="newFood.carbs_g" type="number" placeholder="grams (e.g. 15)" class="input">
            </div>
            <div class="form-field">
              <label>Fat:</label>
              <input [(ngModel)]="newFood.fat_g" type="number" placeholder="grams (e.g. 8)" class="input">
            </div>
            <button (click)="addFood()" class="btn-primary">Add Food</button>
          </div>
          }
          
          <div class="food-list">
            @for (food of currentData.food_diary; track $index) {
            <div class="food-item">
              <div class="food-info">
                <div class="food-name">{{food.item}}</div>
                <div class="food-details">{{food.calories | number:'1.0-0'}} cal ‚Ä¢ {{food.protein_g | number:'1.0-0'}}g protein ‚Ä¢ {{food.carbs_g | number:'1.0-0'}}g carbs ‚Ä¢ {{food.fat_g | number:'1.0-0'}}g fat</div>
              </div>
              <button class="delete-btn" (click)="removeFood($index)">√ó</button>
            </div>
            }
          </div>
        </div>

        <div class="card exercise-card">
          <div class="card-header">
            <h3><i class="icon">üèÉ</i> Exercise Log</h3>
            <button class="add-btn" (click)="showAddExercise = !showAddExercise">{{showAddExercise ? '‚àí' : '+'}}</button>
          </div>
          
          @if (showAddExercise) {
          <div class="add-form">
            <div class="form-field">
              <label>Type:</label>
              <select [(ngModel)]="newExercise.type" class="input">
                <option value="cardio">Cardio</option>
                <option value="strength">Strength</option>
              </select>
            </div>
            @if (newExercise.type === 'cardio') {
            <div class="form-field">
              <label>Activity:</label>
              <select [(ngModel)]="newExercise.cardioType" class="input">
                <option value="Running">Running</option>
                <option value="Walking">Walking</option>
                <option value="Cycling">Cycling</option>
                <option value="Swimming">Swimming</option>
                <option value="Elliptical">Elliptical</option>
              </select>
            </div>
            <div class="form-field">
              <label>Distance:</label>
              <input [(ngModel)]="newExercise.distance" type="number" step="0.01" placeholder="km (e.g. 5.2)" class="input">
            </div>
            } @else {
            <div class="form-field">
              <label>Target:</label>
              <input [(ngModel)]="newExercise.strengthTarget" placeholder="e.g. Upper Body, Legs" class="input">
            </div>
            }
            <div class="form-field">
              <label>Duration:</label>
              <input [(ngModel)]="newExercise.duration" type="number" placeholder="minutes (e.g. 30)" class="input">
            </div>
            <div class="form-field">
              <label>Calories:</label>
              <input [(ngModel)]="newExercise.calories" type="number" placeholder="burned (e.g. 250)" class="input">
            </div>
            <button (click)="addExercise()" class="btn-primary">Add Exercise</button>
          </div>
          }
          
          <div class="exercise-list">
            @for (exercise of getExerciseList(); track $index) {
            <div class="exercise-item">
              <div class="exercise-type">{{exercise.icon}} {{exercise.name}}</div>
              <div class="exercise-details">{{exercise.details}}</div>
            </div>
            }
            
            <div class="exercise-summary">
              <div class="summary-total">
                <strong>Total: {{getTotalExerciseTime() | number:'1.0-0'}} min ‚Ä¢ {{currentData.exercise_summary.total_burned_calories | number:'1.0-0'}} cal</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="section-buttons">
        <button class="section-toggle json-toggle" (click)="showJson = !showJson">
          {{showJson ? '‚ñº' : '‚ñ∂'}} View JSON Data
        </button>
      </div>
      
      @if (showJson) {
      <div class="json-viewer">
        <div class="json-card">
          <div class="json-header">
            <h3>üìÑ Raw JSON Data</h3>
            <div class="json-actions">
              <button class="copy-btn" (click)="copyJson()">üìã Copy</button>
              <button class="export-btn" (click)="exportData()">üì§ Export</button>
              <button class="import-btn" (click)="importData()">üì• Import File</button>
              <button class="import-text-btn" (click)="showJsonImport = !showJsonImport">üìù Import Text</button>
              <button class="struct-btn" (click)="copyStructure()">üèóÔ∏è Structure</button>
            </div>
          </div>
          <pre class="json-content" [hidden]="showJsonImport">{{getFormattedJson()}}</pre>
          
          @if (showJsonImport) {
          <div class="json-import">
            <h4>Import JSON Data</h4>
            <textarea [(ngModel)]="jsonTextArea" placeholder="Paste JSON data here..." rows="18" class="json-textarea"></textarea>
            <div class="import-actions">
              <button class="btn-primary" (click)="importJsonFromText()">Import JSON</button>
              <button class="btn-secondary" (click)="showJsonImport = false; jsonTextArea = ''">Cancel</button>
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>
    </div>
  }

  @if (!currentData && !loading) {
  <div class="no-data">
    <div class="no-data-card">
      <div class="no-data-icon">üìÖ</div>
      <h2>No Data Found</h2>
      <p>No fitness data available for {{selectedDate | date:'EEEE, MMMM d, y'}}</p>
      <button class="btn-create" (click)="createEmptyData()">Create New Entry</button>
    </div>
  </div>
  }
</div>
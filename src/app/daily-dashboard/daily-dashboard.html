<div class="daily-dashboard">
  <header class="header">
    <h1><i class="icon">üí™</i> FITNESS TRACKER</h1>
    <div class="date">{{today | date:'fullDate'}}</div>
  </header>

  <div class="date-selector-header">
    <div class="date-selector">
      <button class="date-nav" (click)="changeDate(-1)">‚óÄ</button>
      <input type="date" [(ngModel)]="selectedDateString" (change)="onDateChange()" class="date-input">
      <button class="date-nav" (click)="changeDate(1)">‚ñ∂</button>
    </div>
    <div class="dashboard-date text-center">{{selectedDate | date:'EEEE, MMMM d, y'}}</div>
  </div>

  @if (currentData) {
  <div class="dashboard">
    <div class="dashboard-section">
      <div class="dashboard-header">
        <h2 class="section-title">üìä Today's Dashboard</h2>
      </div>
      
      <div class="primary-stats">
        <div class="primary-card calories-card">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">üî•</span>
              <span class="stat-title">Calories</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.total_intake_calories}}</span>
              <span class="stat-unit">/ {{currentData.user_profile.goal_calories}}</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress calories-progress" [style.width.%]="getCalorieProgress()"></div>
              </div>
              <span class="progress-text">{{getCalorieProgress()}}% of goal</span>
            </div>
          </div>
        </div>
        
        <div class="primary-card protein-card">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">ü•õ</span>
              <span class="stat-title">Protein</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.total_protein_g}}</span>
              <span class="stat-unit">g / {{currentData.user_profile.maintenance_protein_target_g}}g</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress protein-progress" [style.width.%]="getProteinProgress()"></div>
              </div>
              <span class="progress-text">{{getProteinProgress()}}% of target</span>
            </div>
          </div>
        </div>
        
        <div class="primary-card status-card" [class]="'status-' + getStatusClass()">
          <div class="card-content">
            <div class="stat-header">
              <span class="stat-icon">{{getStatusEmoji()}}</span>
              <span class="stat-title">Status</span>
            </div>
            <div class="stat-main">
              <span class="stat-value">{{currentData.daily_total_stats.net_calories}}</span>
              <span class="stat-unit">net cal</span>
            </div>
            <div class="status-label">{{getStatusText()}}</div>
          </div>
        </div>
      </div>
      
      <div class="secondary-stats">
        <div class="stat-tile">
          <div class="tile-icon">‚ö°</div>
          <div class="tile-value">{{currentData.exercise_summary.total_burned_calories}}</div>
          <div class="tile-label">Burned</div>
        </div>
        
        <div class="stat-tile weight-tile">
          <div class="tile-icon">‚öñÔ∏è</div>
          @if (!editingWeight) {
          <div class="tile-value" (click)="startEditWeight()">{{currentData.user_profile.weight_kg}}kg</div>
          <div class="tile-label">Weight (click to edit)</div>
          <div class="tile-sublabel">BMI: {{getBMI()}} ({{getBMICategory()}})</div>
          } @else {
          <div class="weight-edit">
            <input [(ngModel)]="tempWeight" type="number" class="weight-input" placeholder="Weight">
            <div class="weight-actions">
              <button class="save-btn" (click)="saveWeight()">‚úì</button>
              <button class="cancel-btn" (click)="cancelEditWeight()">√ó</button>
            </div>
          </div>
          }
        </div>
        
        <div class="stat-tile" [class]="getCarbsStatus()">
          <div class="tile-icon">üçû</div>
          <div class="tile-value">{{currentData.daily_total_stats.total_carbs_g}}g</div>
          <div class="tile-label">Carbs {{getCarbsPercentage()}} (45-65%)</div>
          <div class="tile-sublabel">{{getCarbsDescription()}}</div>
        </div>
        
        <div class="stat-tile" [class]="getFatStatus()">
          <div class="tile-icon">ü•ë</div>
          <div class="tile-value">{{currentData.daily_total_stats.total_fat_g}}g</div>
          <div class="tile-label">Fat {{getFatPercentage()}} (20-35%)</div>
          <div class="tile-sublabel">{{getFatDescription()}}</div>
        </div>
      </div>
    </div>

    <div class="overview-section">
      <div class="overview-grid">
        <div class="overview-card goals">
          <h3>üéØ Daily Goals</h3>
          <div class="goal-progress">
            <div class="goal-item">
              <span>Calories: {{currentData.daily_total_stats.total_intake_calories}}/{{currentData.user_profile.goal_calories}}</span>
              <div class="mini-progress">
                <div class="mini-bar" [style.width.%]="getCalorieProgress()"></div>
              </div>
            </div>
            <div class="goal-item">
              <span>Protein: {{currentData.daily_total_stats.total_protein_g}}/{{currentData.user_profile.maintenance_protein_target_g}}g</span>
              <div class="mini-progress">
                <div class="mini-bar" [style.width.%]="getProteinProgress()"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="overview-card summary">
          <h3>üìà Today's Summary</h3>
          <div class="summary-stats">
            <div class="summary-item">
              <span class="summary-label">Total Intake:</span>
              <span class="summary-value">{{currentData.daily_total_stats.total_intake_calories}} cal</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Exercise Burned:</span>
              <span class="summary-value">{{currentData.exercise_summary.total_burned_calories}} cal</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Net Balance:</span>
              <span class="summary-value" [class]="getStatusClass()">{{currentData.daily_total_stats.net_calories}} cal</span>
            </div>
          </div>
        </div>
        
        <div class="overview-card ai-evaluation">
          <h3>ü§ñ AI Evaluation</h3>
          <div class="ai-stats">
            <div class="ai-item">
              <span class="ai-label">Muscle Maintenance:</span>
              <span class="ai-value">{{currentData.ai_evaluation.muscle_maintenance}}</span>
            </div>
            <div class="ai-item">
              <span class="ai-label">Weight Loss Status:</span>
              <span class="ai-value">{{currentData.ai_evaluation.weight_loss_status}}</span>
            </div>
            <div class="ai-recommendation">
              <span class="ai-label">Recommendation:</span>
              <p class="ai-text">{{currentData.ai_evaluation.recommendation}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="details-section">
      <div class="content-grid">
        <div class="card food-card">
          <div class="card-header">
            <h3><i class="icon">üçΩÔ∏è</i> Food Diary</h3>
            <button class="add-btn" (click)="showAddFood = !showAddFood">+</button>
          </div>
          
          @if (showAddFood) {
          <div class="add-form">
            <input [(ngModel)]="newFood.item" placeholder="Food item" class="input">
            <input [(ngModel)]="newFood.calories" type="number" placeholder="Calories" class="input">
            <input [(ngModel)]="newFood.protein_g" type="number" placeholder="Protein (g)" class="input">
            <input [(ngModel)]="newFood.carbs_g" type="number" placeholder="Carbs (g)" class="input">
            <input [(ngModel)]="newFood.fat_g" type="number" placeholder="Fat (g)" class="input">
            <button (click)="addFood()" class="btn-primary">Add Food</button>
          </div>
          }
          
          <div class="food-list">
            @for (food of currentData.food_diary; track $index) {
            <div class="food-item">
              <div class="food-info">
                <div class="food-name">{{food.item}}</div>
                <div class="food-details">{{food.calories}} cal ‚Ä¢ {{food.protein_g}}g protein ‚Ä¢ {{food.carbs_g}}g carbs ‚Ä¢ {{food.fat_g}}g fat</div>
              </div>
              <button class="delete-btn" (click)="removeFood($index)">√ó</button>
            </div>
            }
          </div>
        </div>

        <div class="card exercise-card">
          <div class="card-header">
            <h3><i class="icon">üèÉ</i> Exercise Log</h3>
            <button class="add-btn" (click)="showAddExercise = !showAddExercise">+</button>
          </div>
          
          @if (showAddExercise) {
          <div class="add-form">
            <select [(ngModel)]="newExercise.type" class="input">
              <option value="cardio">Cardio</option>
              <option value="strength">Strength</option>
            </select>
            <input [(ngModel)]="newExercise.duration" type="number" placeholder="Duration (min)" class="input">
            <input [(ngModel)]="newExercise.calories" type="number" placeholder="Calories burned" class="input">
            <button (click)="addExercise()" class="btn-primary">Add Exercise</button>
          </div>
          }
          
          <div class="exercise-list">
            @if (currentData.exercise_summary.cardio_session_1) {
            <div class="exercise-item">
              <div class="exercise-type">üèÉ {{currentData.exercise_summary.cardio_session_1.type}} #1</div>
              <div class="exercise-details">
                {{currentData.exercise_summary.cardio_session_1.distance_mi}} mi ‚Ä¢ 
                {{currentData.exercise_summary.cardio_session_1.duration_min}} min ‚Ä¢ 
                {{currentData.exercise_summary.cardio_session_1.calories_burned}} cal
              </div>
            </div>
            }
            
            @if (currentData.exercise_summary.cardio_session_2) {
            <div class="exercise-item">
              <div class="exercise-type">üèÉ {{currentData.exercise_summary.cardio_session_2.type}} #2</div>
              <div class="exercise-details">
                {{currentData.exercise_summary.cardio_session_2.distance_mi}} mi ‚Ä¢ 
                {{currentData.exercise_summary.cardio_session_2.duration_min}} min ‚Ä¢ 
                {{currentData.exercise_summary.cardio_session_2.calories_burned}} cal
              </div>
            </div>
            }
            
            @if (currentData.exercise_summary.strength_training) {
            <div class="exercise-item">
              <div class="exercise-type">üí™ {{currentData.exercise_summary.strength_training.target}}</div>
              <div class="exercise-details">
                {{currentData.exercise_summary.strength_training.duration_min}} min ‚Ä¢ 
                {{currentData.exercise_summary.strength_training.calories_burned}} cal
              </div>
            </div>
            }
          </div>
        </div>
      </div>
      
      <div class="section-buttons">
        <button class="section-toggle json-toggle" (click)="showJson = !showJson">
          {{showJson ? '‚ñº' : '‚ñ∂'}} View JSON Data
        </button>
      </div>
      
      @if (showJson) {
      <div class="json-viewer">
        <div class="json-card">
          <div class="json-header">
            <h3>üìÑ Raw JSON Data</h3>
            <div class="json-actions">
              <button class="copy-btn" (click)="copyJson()">üìã Copy</button>
              <button class="export-btn" (click)="exportData()">üì§ Export</button>
              <button class="import-btn" (click)="importData()">üì• Import File</button>
              <button class="import-text-btn" (click)="showJsonImport = !showJsonImport">üìù Import Text</button>
            </div>
          </div>
          <pre class="json-content">{{getFormattedJson()}}</pre>
          
          @if (showJsonImport) {
          <div class="json-import">
            <h4>Import JSON Data</h4>
            <textarea [(ngModel)]="jsonTextArea" placeholder="Paste JSON data here..." rows="10" class="json-textarea"></textarea>
            <div class="import-actions">
              <button class="btn-primary" (click)="importJsonFromText()">Import JSON</button>
              <button class="btn-secondary" (click)="showJsonImport = false; jsonTextArea = ''">Cancel</button>
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>
    </div>
  }

  @if (!currentData) {
  <div class="no-data">
    <div class="no-data-card">
      <div class="no-data-icon">üìÖ</div>
      <h2>No Data Found</h2>
      <p>No fitness data available for {{selectedDate | date:'EEEE, MMMM d, y'}}</p>
      <button class="btn-create" (click)="createEmptyData()">Create New Entry</button>
    </div>
  </div>
  }
</div>
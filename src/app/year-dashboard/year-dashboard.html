<div class="year-dashboard">
  @if (loading) {
  <div class="loading">
    <div class="loading-spinner"></div>
    <p>Loading ...</p>
  </div>
  } @else {
  <div class="year-header">
    <div class="year-nav-group">
      <button class="year-nav" (click)="changeYear(-1)">â—€</button>
      <h2 class="year-title">ğŸ“… {{currentYear}}</h2>
      <button class="year-nav" (click)="changeYear(1)">â–¶</button>
    </div>
    <button class="copy-api-btn" (click)="copyRawApiResponse()" title="Export Raw API Response">ğŸ“‹ Export</button>
  </div>

  <div class="year-stats">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-value">{{yearlyStats.totalActiveDays}}</div>
      <div class="stat-label">Active Days</div>
      <div class="completion-bar">
        <div class="completion-fill" [style.width.%]="yearlyStats.completionRate"></div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">ğŸ”¥</div>
      <div class="stat-value">{{yearlyStats.avgCalories | number:'1.0-0'}}</div>
      <div class="stat-label">Avg Calories</div>
      <div class="additional-stats">
        <div class="additional-stat">
          <span class="additional-label">Total Calories:</span>
          <span class="additional-value">{{getTotalCalories() | number:'1.0-0'}}</span>
        </div>
        <div class="additional-stat">
          <span class="additional-label">Min Max:</span>
          <span class="additional-value">{{getMinCalories() | number:'1.0-0'}}/{{getMaxCalories() | number:'1.0-0'}}</span>
        </div>
      </div>
    </div>

    <div class="stat-card activity-analysis">
      <div class="stat-icon">ğŸƒ</div>
      <div class="stat-value">{{getActivityScore() | number:'1.0-0'}}%</div>
      <div class="stat-label">Activity Score</div>
      <div class="stat-sublabel">{{getActivityStatus()}}</div>
      <div class="additional-stats">
        <div class="additional-stat">
          <span class="additional-label">Active Days:</span>
          <span class="additional-value">{{yearlyStats.totalActiveDays}}</span>
        </div>
        <div class="additional-stat">
          <span class="additional-label">Total Burned:</span>
          <span class="additional-value">{{yearlyStats.totalBurned | number:'1.0-0'}} cal</span>
        </div>
        <div class="additional-stat">
          <span class="additional-label">Best Month:</span>
          <span class="additional-value">{{yearlyStats.bestMonth}}</span>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">ğŸ¥›</div>
      <div class="stat-value">{{yearlyStats.avgProtein | number:'1.0-0'}}g</div>
      <div class="stat-label">Avg Protein</div>
      <div class="additional-stats">
        <div class="additional-stat">
          <span class="additional-label">Total Protein:</span>
          <span class="additional-value">{{getTotalProtein() | number:'1.0-0'}}g</span>
        </div>
        <div class="additional-stat">
          <span class="additional-label">Min Max:</span>
          <span class="additional-value">{{getMinProtein() | number:'1.0-0'}}/{{getMaxProtein() | number:'1.0-0'}}g</span>
        </div>
      </div>
    </div>

    <div class="stat-card net-cal-analysis">
      <div class="stat-icon">ğŸ’¡</div>
      <div class="stat-value" [class]="getDifferenceClass()">{{getCalorieDifference() | number:'1.0-0'}} cal</div>
      <div class="stat-label">Avg Net vs Goal</div>
      <div class="stat-sublabel">{{getNetCalorieRecommendation()}}</div>
      <div class="additional-stats">
        <div class="additional-stat">
          <span class="additional-label">Total Calories:</span>
          <span class="additional-value">{{getTotalCalories() | number:'1.0-0'}}</span>
        </div>
        <div class="additional-stat">
          <span class="additional-label">Est. Weight Loss:</span>
          <span class="additional-value">{{getEstimatedWeightDecrease() | number:'1.1-1'}} kg</span>
        </div>
      </div>
    </div>
  </div>

  <div class="months-grid">
    @for (month of monthsData; track month.month) {
      <div class="month-card" [class]="month.status" (click)="onMonthClick(month.month)">
        <div class="month-name">{{month.name}}</div>
        <div class="month-stats">
          <div class="month-stat">
            <span class="stat-number">{{month.activeDays}}</span>
            <span class="stat-text">days</span>
          </div>
          <div class="month-stat">
            <span class="stat-number">{{month.avgCalories | number:'1.0-0'}}</span>
            <span class="stat-text">cal</span>
          </div>
        </div>
        <div class="month-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="month.completionRate"></div>
          </div>
          <span class="progress-text">{{month.completionRate | number:'1.0-0'}}%</span>
        </div>
      </div>
    }
  </div>
  }
</div>